!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.DzhyunConnection=e():t.DzhyunConnection=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=3)}([function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e,n){var r=/^((\w+):\/\/)?(.*)/.exec(t),o=i(r,4),u=o[2],a=void 0===u?"http":u,f=o[3],c=s[a];if(!c)throw new Error('protocol "'+a+'" no support');return c(f,e,n)}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var u,s=t[Symbol.iterator]();!(r=(u=s.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();"function"!=typeof Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=0;n<(arguments.length<=1?0:arguments.length-1);n+=1){var r=arguments.length<=n+1?void 0:arguments[n+1];if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e});var s=function(){function t(e,n,i,u){if(r(this,t),"string"!=typeof e)throw new Error("address is incorrect");if(this.constructor===t)return o(e,n,i);this._address=e,this.options=n||{},"boolean"==typeof i?(this._secure=i,this._handler=null):(this._secure=u||!1,this._handler=i),this._protocol="http",this._listenerMap={}}return u(t,[{key:"getAddress",value:function(){return this.getProtocol()+"://"+this._address.replace(/^(\w+:\/\/)?/,"")}},{key:"getProtocol",value:function(){return this._protocol+(this._secure?"s":"")}},{key:"request",value:function(t,e){}},{key:"send",value:function(t,e){return this.request(t,e)}},{key:"close",value:function(){}},{key:"on",value:function(t,e){if("function"==typeof e){var n=this._listenerMap[t]||(this._listenerMap[t]=[]);n.indexOf(e)<0&&n.push(e)}return this}},{key:"off",value:function(t,e){if("function"==typeof e){var n=this._listenerMap[t]||(this._listenerMap[t]=[]),r=n.indexOf(e);r>=0&&n.splice(r,1)}return this}},{key:"trigger",value:function(t){for(var e,n=this,r=arguments.length,o=Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];var u=this._listenerMap[t];return u&&u.forEach(function(t){return t.apply(n,o)}),this._handler&&"function"==typeof this._handler[t]&&(e=this._handler)[t].apply(e,o),this}}]),t}();s.EVENT_OPEN="open",s.EVENT_CLOSE="close",s.EVENT_ERROR="error",s.EVENT_REQUEST="request",s.EVENT_SEND="send",s.EVENT_RESPONSE="response",s.EVENT_MESSAGE="message",s.EVENT_PROGRESS="progress",e.default=s},,function(t,e,n){"use strict";var r=n(7),o=function(t){return t&&t.__esModule?t:{default:t}}(r);"undefined"!=typeof window?window.WebSocket?t.exports=window.WebSocket:console.warn("当前浏览器不支持WebSocket"):"undefined"!=typeof WebSocket?t.exports=WebSocket:t.exports=o.default},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(0),f=r(a),c=n(2),l=r(c),d=function(t){function e(t,n,r,u){o(this,e);var s=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r,u));return s._protocol="ws",s._ws=null,!1===(n&&!0===n.deferred||!1)&&s._connect(),s}return u(e,t),s(e,[{key:"getStatus",value:function(){return this._ws?this._ws.readyState:l.default.CLOSED}},{key:"_connect",value:function(){var t=this;if(void 0===l.default)throw Error("Don't support WebSocket");this._ws=new l.default(this.getAddress()),void 0===l.default.OPEN&&(l.default.CONNECTING=this._ws.CONNECTING,l.default.OPEN=this._ws.OPEN,l.default.CLOSING=this._ws.CLOSING,l.default.CLOSED=this._ws.CLOSED),this._ws.binaryType=this.options.binaryType||this.options.dataType||"arraybuffer",this._ws.addEventListener("open",function(){t.trigger(f.default.EVENT_OPEN)}),this._ws.addEventListener("error",function(e){t.trigger(f.default.EVENT_ERROR,e)}),this._ws.addEventListener("close",function(){t.trigger(f.default.EVENT_CLOSE)}),this._ws.addEventListener("message",function(e){t.trigger(f.default.EVENT_MESSAGE,e.data),t.trigger(f.default.EVENT_RESPONSE,e.data)})}},{key:"request",value:function(t){var e=this,n=t||"";return this.getStatus()===l.default.CLOSED&&this._connect(),this.getStatus()!==l.default.OPEN?this._ws.addEventListener("open",function(){e._ws.send(n),e.trigger(f.default.EVENT_SEND,n),e.trigger(f.default.EVENT_REQUEST,n)}):(this._ws.send(n),this.trigger(f.default.EVENT_SEND,n),this.trigger(f.default.EVENT_REQUEST,n)),this}},{key:"close",value:function(){return this.getStatus()!==l.default.CLOSED&&(this._ws.close(),this._ws=null),this}}]),e}(f.default);f.default.ws=function(t,e,n){return new d(t,e,n,!1)},f.default.wss=function(t,e,n){return new d(t,e,n,!0)},t.exports=f.default},,,,function(t,e){}])});