!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.DzhyunConnection=e():t.DzhyunConnection=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=12)}([function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e,n){var r=/^((\w+):\/\/)?(.*)/.exec(t),o=s(r,4),i=o[2],h=void 0===i?"http":i,u=o[3],c=a[h];if(!c)throw new Error('protocol "'+h+'" no support');return c(u,e,n)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){var n=[],r=!0,o=!1,s=void 0;try{for(var i,a=t[Symbol.iterator]();!(r=(i=a.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){o=!0,s=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw s}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();"function"!=typeof Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=0;n<(arguments.length<=1?0:arguments.length-1);n+=1){var r=arguments.length<=n+1?void 0:arguments[n+1];if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e});var a=function(){function t(e,n,s,i){if(r(this,t),"string"!=typeof e)throw new Error("address is incorrect");if(this.constructor===t)return o(e,n,s);this._address=e,this.options=n||{},"boolean"==typeof s?(this._secure=s,this._handler=null):(this._secure=i||!1,this._handler=s),this._protocol="http",this._listenerMap={}}return i(t,[{key:"getAddress",value:function(){return this.getProtocol()+"://"+this._address.replace(/^(\w+:\/\/)?/,"")}},{key:"getProtocol",value:function(){return this._protocol+(this._secure?"s":"")}},{key:"request",value:function(t,e){}},{key:"send",value:function(t,e){return this.request(t,e)}},{key:"close",value:function(){}},{key:"on",value:function(t,e){if("function"==typeof e){var n=this._listenerMap[t]||(this._listenerMap[t]=[]);n.indexOf(e)<0&&n.push(e)}return this}},{key:"off",value:function(t,e){if("function"==typeof e){var n=this._listenerMap[t]||(this._listenerMap[t]=[]),r=n.indexOf(e);r>=0&&n.splice(r,1)}return this}},{key:"trigger",value:function(t){for(var e,n=this,r=arguments.length,o=Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];var i=this._listenerMap[t];return i&&i.forEach(function(t){return t.apply(n,o)}),this._handler&&"function"==typeof this._handler[t]&&(e=this._handler)[t].apply(e,o),this}}]),t}();a.EVENT_OPEN="open",a.EVENT_CLOSE="close",a.EVENT_ERROR="error",a.EVENT_REQUEST="request",a.EVENT_SEND="send",a.EVENT_RESPONSE="response",a.EVENT_MESSAGE="message",a.EVENT_PROGRESS="progress",e.default=a},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){(function(t){/*! (c) 2017 Andrea Giammarchi (ISC) */
!function(){"use strict";var e="object"==typeof t?t:self,n=[].findIndex||function(t,e){for(var n=this.length;n--;)if(t.call(e,this[n]))return n;return n},r=Object.defineProperty,o="__event-target__"+Math.random(),s=e.WeakMap||function(){return{get:function(t){return t[o]},set:function(t,e){r(t,o,{configurable:!0,value:e})}}},i=e.EventTarget;try{new i}catch(t){i=function(){function t(){}function e(t){var e=t.options;e&&e.once&&h.call(t.target,this.type,t.listener,t.options),"function"==typeof t.listener?t.listener.call(t.target,this):t.listener.handleEvent(this)}function o(t){return this===t.listener}function i(t,e,r){var s=l(this),i=s[t]||(s[t]=[]);n.call(i,o,e)<0&&i.push({target:this,listener:e,options:r})}function a(t){var n=l(this),r=n[t.type];return r&&(p(t,{currentTarget:this,target:this}),r.forEach(e,t),delete t.currentTarget,delete t.target),!0}function h(t,e,r){var s=l(this),i=s[t];if(i){var a=n.call(i,o,e);-1<a&&i.splice(a,1)}}function u(){}var c=new s,l=function(t){return c.get(t)||f(t)},f=function(t){var e=new u;return c.set(t,e),e},p=function(t,e){for(var n in e)r(t,n,{configurable:!0,value:e[n]})};return p(t.prototype,{addEventListener:i,dispatchEvent:a,removeEventListener:h}),u.prototype=Object.create(null),t}()}}()}).call(e,n(1))},function(t,e,n){"use strict";function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function o(t,e,n){if(t&&u.isObject(t)&&t instanceof r)return t;var o=new r;return o.parse(t,e,n),o}function s(t){return u.isString(t)&&(t=o(t)),t instanceof r?t.format():r.prototype.format.call(t)}function i(t,e){return o(t,!1,!0).resolve(e)}function a(t,e){return t?o(t,!1,!0).resolveObject(e):e}var h=n(4),u=n(8);e.parse=o,e.resolve=i,e.resolveObject=a,e.format=s,e.Url=r;var c=/^([a-z0-9.+-]+:)/i,l=/:[0-9]*$/,f=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,p=["<",">",'"',"`"," ","\r","\n","\t"],d=["{","}","|","\\","^","`"].concat(p),v=["'"].concat(d),y=["%","/","?",";","#"].concat(v),m=["/","?","#"],g=/^[+a-z0-9A-Z_-]{0,63}$/,E=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,b={javascript:!0,"javascript:":!0},w={javascript:!0,"javascript:":!0},O={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},_=n(7);r.prototype.parse=function(t,e,n){if(!u.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var r=t.indexOf("?"),o=-1!==r&&r<t.indexOf("#")?"?":"#",s=t.split(o),i=/\\/g;s[0]=s[0].replace(i,"/"),t=s.join(o);var a=t;if(a=a.trim(),!n&&1===t.split("#").length){var l=f.exec(a);if(l)return this.path=a,this.href=a,this.pathname=l[1],l[2]?(this.search=l[2],this.query=e?_.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var p=c.exec(a);if(p){p=p[0];var d=p.toLowerCase();this.protocol=d,a=a.substr(p.length)}if(n||p||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var j="//"===a.substr(0,2);!j||p&&w[p]||(a=a.substr(2),this.slashes=!0)}if(!w[p]&&(j||p&&!O[p])){for(var S=-1,x=0;x<m.length;x++){var C=a.indexOf(m[x]);-1!==C&&(-1===S||C<S)&&(S=C)}var N,k;k=-1===S?a.lastIndexOf("@"):a.lastIndexOf("@",S),-1!==k&&(N=a.slice(0,k),a=a.slice(k+1),this.auth=decodeURIComponent(N)),S=-1;for(var x=0;x<y.length;x++){var C=a.indexOf(y[x]);-1!==C&&(-1===S||C<S)&&(S=C)}-1===S&&(S=a.length),this.host=a.slice(0,S),a=a.slice(S),this.parseHost(),this.hostname=this.hostname||"";var T="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!T)for(var P=this.hostname.split(/\./),x=0,A=P.length;x<A;x++){var I=P[x];if(I&&!I.match(g)){for(var L="",R=0,q=I.length;R<q;R++)I.charCodeAt(R)>127?L+="x":L+=I[R];if(!L.match(g)){var U=P.slice(0,x),V=P.slice(x+1),M=I.match(E);M&&(U.push(M[1]),V.unshift(M[2])),V.length&&(a="/"+V.join(".")+a),this.hostname=U.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),T||(this.hostname=h.toASCII(this.hostname));var D=this.port?":"+this.port:"",G=this.hostname||"";this.host=G+D,this.href+=this.host,T&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!b[d])for(var x=0,A=v.length;x<A;x++){var W=v[x];if(-1!==a.indexOf(W)){var F=encodeURIComponent(W);F===W&&(F=escape(W)),a=a.split(W).join(F)}}var z=a.indexOf("#");-1!==z&&(this.hash=a.substr(z),a=a.slice(0,z));var $=a.indexOf("?");if(-1!==$?(this.search=a.substr($),this.query=a.substr($+1),e&&(this.query=_.parse(this.query)),a=a.slice(0,$)):e&&(this.search="",this.query={}),a&&(this.pathname=a),O[d]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var D=this.pathname||"",Q=this.search||"";this.path=D+Q}return this.href=this.format(),this},r.prototype.format=function(){var t=this.auth||"";t&&(t=encodeURIComponent(t),t=t.replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",r=this.hash||"",o=!1,s="";this.host?o=t+this.host:this.hostname&&(o=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&u.isObject(this.query)&&Object.keys(this.query).length&&(s=_.stringify(this.query));var i=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||O[e])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),r&&"#"!==r.charAt(0)&&(r="#"+r),i&&"?"!==i.charAt(0)&&(i="?"+i),n=n.replace(/[?#]/g,function(t){return encodeURIComponent(t)}),i=i.replace("#","%23"),e+o+n+i+r},r.prototype.resolve=function(t){return this.resolveObject(o(t,!1,!0)).format()},r.prototype.resolveObject=function(t){if(u.isString(t)){var e=new r;e.parse(t,!1,!0),t=e}for(var n=new r,o=Object.keys(this),s=0;s<o.length;s++){var i=o[s];n[i]=this[i]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),h=0;h<a.length;h++){var c=a[h];"protocol"!==c&&(n[c]=t[c])}return O[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!O[t.protocol]){for(var l=Object.keys(t),f=0;f<l.length;f++){var p=l[f];n[p]=t[p]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||w[t.protocol])n.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),n.pathname=d.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var v=n.pathname||"",y=n.search||"";n.path=v+y}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var m=n.pathname&&"/"===n.pathname.charAt(0),g=t.host||t.pathname&&"/"===t.pathname.charAt(0),E=g||m||n.host&&t.pathname,b=E,_=n.pathname&&n.pathname.split("/")||[],d=t.pathname&&t.pathname.split("/")||[],j=n.protocol&&!O[n.protocol];if(j&&(n.hostname="",n.port=null,n.host&&(""===_[0]?_[0]=n.host:_.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),E=E&&(""===d[0]||""===_[0])),g)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,_=d;else if(d.length)_||(_=[]),_.pop(),_=_.concat(d),n.search=t.search,n.query=t.query;else if(!u.isNullOrUndefined(t.search)){if(j){n.hostname=n.host=_.shift();var S=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");S&&(n.auth=S.shift(),n.host=n.hostname=S.shift())}return n.search=t.search,n.query=t.query,u.isNull(n.pathname)&&u.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!_.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var x=_.slice(-1)[0],C=(n.host||t.host||_.length>1)&&("."===x||".."===x)||""===x,N=0,k=_.length;k>=0;k--)x=_[k],"."===x?_.splice(k,1):".."===x?(_.splice(k,1),N++):N&&(_.splice(k,1),N--);if(!E&&!b)for(;N--;N)_.unshift("..");!E||""===_[0]||_[0]&&"/"===_[0].charAt(0)||_.unshift(""),C&&"/"!==_.join("/").substr(-1)&&_.push("");var T=""===_[0]||_[0]&&"/"===_[0].charAt(0);if(j){n.hostname=n.host=T?"":_.length?_.shift():"";var S=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");S&&(n.auth=S.shift(),n.host=n.hostname=S.shift())}return E=E||n.host&&_.length,E&&!T&&_.unshift(""),_.length?n.pathname=_.join("/"):(n.pathname=null,n.path=null),u.isNull(n.pathname)&&u.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},r.prototype.parseHost=function(){var t=this.host,e=l.exec(t);e&&(e=e[0],":"!==e&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},function(t,e,n){(function(t,r){var o;!function(s){function i(t){throw new RangeError(A[t])}function a(t,e){for(var n=t.length,r=[];n--;)r[n]=e(t[n]);return r}function h(t,e){var n=t.split("@"),r="";return n.length>1&&(r=n[0]+"@",t=n[1]),t=t.replace(P,"."),r+a(t.split("."),e).join(".")}function u(t){for(var e,n,r=[],o=0,s=t.length;o<s;)e=t.charCodeAt(o++),e>=55296&&e<=56319&&o<s?(n=t.charCodeAt(o++),56320==(64512&n)?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),o--)):r.push(e);return r}function c(t){return a(t,function(t){var e="";return t>65535&&(t-=65536,e+=R(t>>>10&1023|55296),t=56320|1023&t),e+=R(t)}).join("")}function l(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:w}function f(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function p(t,e,n){var r=0;for(t=n?L(t/S):t>>1,t+=L(t/e);t>I*_>>1;r+=w)t=L(t/I);return L(r+(I+1)*t/(t+j))}function d(t){var e,n,r,o,s,a,h,u,f,d,v=[],y=t.length,m=0,g=C,E=x;for(n=t.lastIndexOf(N),n<0&&(n=0),r=0;r<n;++r)t.charCodeAt(r)>=128&&i("not-basic"),v.push(t.charCodeAt(r));for(o=n>0?n+1:0;o<y;){for(s=m,a=1,h=w;o>=y&&i("invalid-input"),u=l(t.charCodeAt(o++)),(u>=w||u>L((b-m)/a))&&i("overflow"),m+=u*a,f=h<=E?O:h>=E+_?_:h-E,!(u<f);h+=w)d=w-f,a>L(b/d)&&i("overflow"),a*=d;e=v.length+1,E=p(m-s,e,0==s),L(m/e)>b-g&&i("overflow"),g+=L(m/e),m%=e,v.splice(m++,0,g)}return c(v)}function v(t){var e,n,r,o,s,a,h,c,l,d,v,y,m,g,E,j=[];for(t=u(t),y=t.length,e=C,n=0,s=x,a=0;a<y;++a)(v=t[a])<128&&j.push(R(v));for(r=o=j.length,o&&j.push(N);r<y;){for(h=b,a=0;a<y;++a)(v=t[a])>=e&&v<h&&(h=v);for(m=r+1,h-e>L((b-n)/m)&&i("overflow"),n+=(h-e)*m,e=h,a=0;a<y;++a)if(v=t[a],v<e&&++n>b&&i("overflow"),v==e){for(c=n,l=w;d=l<=s?O:l>=s+_?_:l-s,!(c<d);l+=w)E=c-d,g=w-d,j.push(R(f(d+E%g,0))),c=L(E/g);j.push(R(f(c,0))),s=p(n,m,r==o),n=0,++r}++n,++e}return j.join("")}function y(t){return h(t,function(t){return k.test(t)?d(t.slice(4).toLowerCase()):t})}function m(t){return h(t,function(t){return T.test(t)?"xn--"+v(t):t})}var g=("object"==typeof e&&e&&e.nodeType,"object"==typeof t&&t&&t.nodeType,"object"==typeof r&&r);var E,b=2147483647,w=36,O=1,_=26,j=38,S=700,x=72,C=128,N="-",k=/^xn--/,T=/[^\x20-\x7E]/,P=/[\x2E\u3002\uFF0E\uFF61]/g,A={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},I=w-O,L=Math.floor,R=String.fromCharCode;E={version:"1.4.1",ucs2:{decode:u,encode:c},decode:d,encode:v,toASCII:m,toUnicode:y},void 0!==(o=function(){return E}.call(e,n,e,t))&&(t.exports=o)}()}).call(e,n(9)(t),n(1))},function(t,e,n){"use strict";function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,n,s){e=e||"&",n=n||"=";var i={};if("string"!=typeof t||0===t.length)return i;var a=/\+/g;t=t.split(e);var h=1e3;s&&"number"==typeof s.maxKeys&&(h=s.maxKeys);var u=t.length;h>0&&u>h&&(u=h);for(var c=0;c<u;++c){var l,f,p,d,v=t[c].replace(a,"%20"),y=v.indexOf(n);y>=0?(l=v.substr(0,y),f=v.substr(y+1)):(l=v,f=""),p=decodeURIComponent(l),d=decodeURIComponent(f),r(i,p)?o(i[p])?i[p].push(d):i[p]=[i[p],d]:i[p]=d}return i};var o=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},function(t,e,n){"use strict";function r(t,e){if(t.map)return t.map(e);for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],r));return n}var o=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,n,a){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?r(i(t),function(i){var a=encodeURIComponent(o(i))+n;return s(t[i])?r(t[i],function(t){return a+encodeURIComponent(o(t))}).join(e):a+encodeURIComponent(o(t[i]))}).join(e):a?encodeURIComponent(o(a))+n+encodeURIComponent(o(t)):""};var s=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},i=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e}},function(t,e,n){"use strict";e.decode=e.parse=n(5),e.encode=e.stringify=n(6)},function(t,e,n){"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},,function(t,e,n){"use strict";var r={};r=n("undefined"!=typeof wx?16:18),"undefined"!=typeof window?window.WebSocket?t.exports=window.WebSocket:console.warn("当前浏览器不支持WebSocket"):"undefined"!=typeof WebSocket?t.exports=WebSocket:t.exports=r},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),h=n(0),u=r(h),c=n(11),l=r(c),f=function(t){function e(t,n,r,i){o(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r,i));return a._protocol="ws",a._ws=null,!1===(n&&!0===n.deferred||!1)&&a._connect(),a}return i(e,t),a(e,[{key:"getStatus",value:function(){return this._ws?this._ws.readyState:l.default.CLOSED}},{key:"_connect",value:function(){var t=this;if(void 0===l.default)throw Error("Don't support WebSocket");this._ws=new l.default(this.getAddress()),void 0===l.default.OPEN&&(l.default.CONNECTING=this._ws.CONNECTING,l.default.OPEN=this._ws.OPEN,l.default.CLOSING=this._ws.CLOSING,l.default.CLOSED=this._ws.CLOSED),this._ws.binaryType=this.options.binaryType||this.options.dataType||"arraybuffer",this._ws.addEventListener("open",function(){t.trigger(u.default.EVENT_OPEN)}),this._ws.addEventListener("error",function(e){t.trigger(u.default.EVENT_ERROR,e)}),this._ws.addEventListener("close",function(){t.trigger(u.default.EVENT_CLOSE)}),this._ws.addEventListener("message",function(e){t.trigger(u.default.EVENT_MESSAGE,e.data),t.trigger(u.default.EVENT_RESPONSE,e.data)})}},{key:"request",value:function(t){var e=this,n=t||"";return this.getStatus()===l.default.CLOSED&&this._connect(),this.getStatus()!==l.default.OPEN?this._ws.addEventListener("open",function(){e._ws.send(n),e.trigger(u.default.EVENT_SEND,n),e.trigger(u.default.EVENT_REQUEST,n)}):(this._ws.send(n),this.trigger(u.default.EVENT_SEND,n),this.trigger(u.default.EVENT_REQUEST,n)),this}},{key:"close",value:function(){return this.getStatus()!==l.default.CLOSED&&(this._ws.close(),this._ws=null),this}}]),e}(u.default);u.default.ws=function(t,e,n){return new f(t,e,n,!1)},u.default.wss=function(t,e,n){return new f(t,e,n,!0)},t.exports=u.default},,,,function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(2),i=n(3),a=function(){function t(e){var n=this;if(r(this,t),null==e)throw new TypeError("1 argument needed");try{if("wss:"!=i.parse(e).protocol)throw new Error("protocol must be wss")}catch(t){throw new SyntaxError("url in wrong format,protocol must be wss")}null!=t.instance&&t.instance.close(),t.instance=this,this.url=e,this.readyState=0,this.onopen=null,this.onclose=null,this.onerror=null,this.onmessage=null,wx.connectSocket({url:e}),wx.onSocketOpen(function(){n.readyState=t.OPEN,n.onopen&&n.onopen.call(n),n.dispatchEvent({type:"open"})}),wx.onSocketError(function(t){var e={type:"error",data:t};n.onerror&&n.onerror.call(n,e),n.dispatchEvent(e)}),wx.onSocketMessage(function(e){if(n.readyState===t.OPEN||n.readyState===t.CLOSING){var r={type:"message",data:e.data};n.onmessage&&n.onmessage.call(n,r),n.dispatchEvent(r)}}),wx.onSocketClose(function(){if(n.readyState=t.CLOSED,n.onclose){var e={type:"close",wasClean:!0,code:0,reason:""};n.onclose.call(n,e)}})}return o(t,[{key:"close",value:function(){wx.closeSocket()}},{key:"send",value:function(t){wx.sendSocketMessage({data:t})}}]),t}();a.prototype.addEventListener=s.prototype.addEventListener,a.prototype.removeEventListener=s.prototype.removeEventListener,a.prototype.dispatchEvent=s.prototype.dispatchEvent,a.CONNECTING=0,a.OPEN=1,a.CLOSING=2,a.CLOSED=3,a.instance=null,t.exports=a},,function(t,e){}])});